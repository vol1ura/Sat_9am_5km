<script>
  function parseTimeString(timeStr) {
    const timeParts = timeStr.split(':')
    let seconds = 0
    seconds += parseInt(timeParts.at(-1)) // Seconds
    seconds += parseInt(timeParts.at(-2)) * 60 // Minutes
    seconds += parseInt(timeParts.at(-3) || '0') * 3600 // Hours

    return seconds
  }

  function validateProtocol() {
    const rows = $('tr[id*="result_"]')
    Array.prototype.forEach.call(rows, (row, idx) => {
      const position_cell = $(row).find('td.col-position')
      if(parseInt(position_cell.html()) === idx + 1) {
        position_cell.removeClass('error')
      } else {
        position_cell.addClass('error')
      }

      const next_row = rows[idx+1]
      if(!next_row) { return }

      const current_time = $(row).find('td.col-time_string').html()
      const next_time = $(next_row).find('td.col-time_string')

      if(parseTimeString(current_time) <= parseTimeString(next_time.html())) {
        next_time.removeClass('error')
      } else {
        next_time.addClass('error')
      }
    })
  }

  $(window).on('load', validateProtocol)
</script>
